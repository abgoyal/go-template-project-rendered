project_name: multiprof
version: 2

builds:
  # Linux-only builds (for .deb/.rpm/.apk packages and raw binaries)
  - id: multiprof-linux
    binary: '{{ .ProjectName }}'
    env:
      - CGO_ENABLED=0
    goos: [linux]
    goarch: [amd64, arm64]
    main: ./
    ldflags:
      - -s -w -X main.version={{.Version}}

  # Windows + macOS builds (for raw binaries)
  - id: multiprof-cross
    binary: '{{ .ProjectName }}'
    env:
      - CGO_ENABLED=0
    goos: [windows, darwin]
    goarch: [amd64, arm64]
    main: ./
    ldflags:
      - -s -w -X main.version={{.Version}}

archives:
  # Raw binaries for all platforms (one file per OS/Arch, uncompressed)
  - id: raw-binaries
    ids: [multiprof-linux, multiprof-cross]
    formats: binary
    name_template: '{{ .ProjectName }}_{{ .Os }}_{{ .Arch }}'

nfpms:
  - id: pkg-deb
    ids: [multiprof-linux]
    package_name: multiprof
    vendor: "abgoyal"
    homepage: "https://github.com/abgoyal/multiprof"
    maintainer: "abgoyal <abgoyal@gmail.com>"
    description: "multiple profiles dir manager"
    license: "MIT"
    formats: [deb]
    scripts:
      postinstall: "{{ .Env.DEB_POSTINSTALL_PATH }}"
    contents:
      - src: ./LICENSE
        dst: /usr/share/licenses/{{ .PackageName }}/LICENSE
        type: file

  - id: pkg-rpm
    ids: [multiprof-linux]
    package_name: multiprof
    vendor: "abgoyal"
    homepage: "https://github.com/abgoyal/multiprof"
    maintainer: "abgoyal <abgoyal@gmail.com>"
    description: "multiple profiles dir manager"
    license: "MIT"
    formats: [rpm]
    scripts:
      postinstall: "{{ .Env.RPM_POSTINSTALL_PATH }}"
    contents:
      - src: ./LICENSE
        dst: /usr/share/licenses/{{ .PackageName }}/LICENSE
        type: file

  - id: pkg-apk
    ids: [multiprof-linux]
    package_name: multiprof
    vendor: "abgoyal"
    homepage: "https://github.com/abgoyal/multiprof"
    maintainer: "abgoyal <abgoyal@gmail.com>"
    description: "multiple profiles dir manager"
    license: "MIT"
    formats: [apk]
    contents:
      - src: ./LICENSE
        dst: /usr/share/licenses/{{ .PackageName }}/LICENSE
        type: file

changelog:
  sort: asc
  filters:
    exclude:
      - '^docs:'
      - '^test:'

release:
  prerelease: auto
